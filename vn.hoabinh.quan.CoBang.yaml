id: vn.hoabinh.quan.CoBang
runtime: org.gnome.Platform
runtime-version: "49"
sdk: org.gnome.Sdk
command: cobang
finish-args:
  - --share=network
  - --share=ipc
  # Need to access NetworkManager D-Bus API
  - --system-talk-name=org.freedesktop.NetworkManager.*
  - --socket=wayland
  - --socket=fallback-x11
  - --device=dri
  # Allow shared memory access for images/streaming via flatpak portal
  - --filesystem=host-etc
  - --filesystem=/tmp:create
cleanup:
  - /include
  - /lib/pkgconfig
  - /man
  - /share/doc
  - /share/gtk-doc
  - /share/man
  - /share/pkgconfig
  - "*.la"
  - "*.a"
modules:
  - name: libzbar
    # Ref: https://gitlab.gnome.org/World/Authenticator
    config-opts:
      - --without-java
      - --without-qt
      - --without-gtk
      - --without-xv
      - --without-imagemagick
      - --disable-video
      - --without-dbus
    sources:
      - type: archive
        url: https://github.com/mchehab/zbar/archive/refs/tags/0.23.93.tar.gz
        sha256: 212dfab527894b8bcbcc7cd1d43d63f5604a07473d31a5f02889e372614ebe28
      - type: script
        dest-filename: autogen.sh
        commands:
          - autoreconf -vfi -W none

  - name: python3-build-tools
    buildsystem: simple
    build-commands:
      [
        'python3 -m pip install -U --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST} wheel setuptools flit-core cffi',
      ]
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/a3/dc/17031897dae0efacfea57dfd3a82fdd2a2aeb58e0ff71b77b87e44edc772/setuptools-80.9.0-py3-none-any.whl
        sha256: 062d34222ad13e0cc312a4c02d73f059e86a4acbfbdea8f8f76b28c99f306922
      - type: file
        url: https://files.pythonhosted.org/packages/af/44/31d964a260fcda6bf2f59384231bbf4962ac796a5d36c554162b5411b8db/wheel-0.46.1-py3-none-any.whl
        sha256: f796f65d72750ccde090663e466d0ca37cd72b62870f7520b96d34cdc07d86d8
      - type: file
        url: https://files.pythonhosted.org/packages/f2/65/b6ba90634c984a4fcc02c7e3afe523fef500c4980fec67cc27536ee50acf/flit_core-3.12.0-py3-none-any.whl
        sha256: e7a0304069ea895172e3c7bb703292e992c5d1555dd1233ab7b5621b5b69e62c
      - type: file
        url: https://files.pythonhosted.org/packages/c8/53/c322bf0486a938ad954a645866b67e978777d79183cf0a042bda6bea11de/cython-3.2.0-cp313-cp313-manylinux2014_aarch64.manylinux_2_17_aarch64.manylinux_2_28_aarch64.whl
        sha256: a9d38cd3aab720d21fa6d6ee168228352f69aea0a95bd4fb84e8879c6ed38fbb
      - type: file
        url: https://files.pythonhosted.org/packages/cd/48/55d02dba0606768d3450afd088e2bbcd6f8a54977dce041c2c3c1894631c/cython-3.2.0-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl
        sha256: 92b31d0b7b0a49b3d2aa94faaf75d44a03174cff2616b341a8853c919e511d51
      - type: file
        url: https://files.pythonhosted.org/packages/52/82/01f0b63287cb922e5ba96c5147c30f1e51f541ce91bd178025bb3518b1ba/cython-3.2.0.tar.gz
        sha256: 41fdce8237baee2d961c292ed0386903dfe126f131e450a62de0fd7a5280d4b2
      - type: file
        url: https://files.pythonhosted.org/packages/78/2d/7fa73dfa841b5ac06c7b8855cfc18622132e365f5b81d02230333ff26e9e/cffi-2.0.0-cp312-cp312-manylinux2014_x86_64.manylinux_2_17_x86_64.whl
        sha256: 3e17ed538242334bf70832644a32a7aae3d83b57567f9fd60a26257e992b79ba
      - type: file
        url: https://files.pythonhosted.org/packages/d5/72/12b5f8d3865bf0f87cf1404d8c374e7487dcf097a1c91c436e72e6badd83/cffi-2.0.0-cp312-cp312-manylinux2014_aarch64.manylinux_2_17_aarch64.whl
        sha256: b21e08af67b8a103c71a250401c78d5e0893beff75e28c53c98f4de42f774062
      - type: file
        url: https://files.pythonhosted.org/packages/eb/56/b1ba7935a17738ae8453301356628e8147c79dbb825bcbc73dc7401f9846/cffi-2.0.0.tar.gz
        sha256: 44d1b5909021139fe36001ae048dbdde8214afa20200eda0f64c068cac5d5529
      - type: file
        url: https://files.pythonhosted.org/packages/a0/e3/59cd50310fc9b59512193629e1984c1f95e5c8ae6e5d8c69532ccc65a7fe/pycparser-2.23-py3-none-any.whl
        sha256: e5c6e8d3fbad53479cab09ac03729e0a9faf2bee3db8208a550daf5af81a5934

  - flatpak/generated-sources.yml

  # We don't build GStreamer because org.gnome.Platform 47+ already provides it

  - name: libportal
    buildsystem: meson
    sources:
      - type: archive
        url: https://github.com/flatpak/libportal/archive/0.9.1.tar.gz
        sha256: ea422b789ae487e04194d387bea031fd7485bf88a18aef8c767f7d1c29496a4e
        x-checker-data:
          type: anitya
          project-id: 230124
          stable-only: true
          url-template: https://github.com/flatpak/libportal/archive/$version.tar.gz

  - name: intltool
    sources:
      - type: archive
        url: https://launchpad.net/intltool/trunk/0.51.0/+download/intltool-0.51.0.tar.gz
        sha256: 67c74d94196b153b774ab9f89b2fa6c6ba79352407037c8c14d5aeb334e959cd

  - name: pwquality
    buildsystem: autotools
    config-opts:
      - --disable-python-bindings
    sources:
      - type: git
        tag: libpwquality-1.4.5
        url: https://github.com/libpwquality/libpwquality.git

  - name: libndp
    buildsystem: autotools
    sources:
      - type: git
        tag: v1.8
        url: https://github.com/jpirko/libndp.git

  # Ref: https://gitlab.gnome.org/GNOME/gnome-control-center/-/tree/main/build-aux/flatpak
  - name: polkit
    buildsystem: meson
    config-opts:
      - -Dauthfw=shadow
      - -Dlibs-only=true
    rm-configure: true
    cleanup:
      - /bin/*
      - /etc/pam.d
      - /etc/dbus-1
      - /share/dbus-1/system-services/*
      - /share/polkit-1
      - /lib/polkit-1
    sources:
      - type: archive
        url: https://github.com/polkit-org/polkit/archive/refs/tags/126.tar.gz
        sha256: 2814a7281989f6baa9e57bd33bbc5e148827e2721ccef22aaf28ab2b376068e8

  - name: udev
    config-opts:
      - --disable-hwdb
      - --disable-logging
      - --disable-gudev
      - --disable-introspection
      - --disable-keymap
      - --disable-mtd_probe
    cleanup:
      - /include
      - /etc
      - /libexec
      - /sbin
      - /lib/pkgconfig
      - /man
      - /share/aclocal
      - /share/doc
      - /share/gtk-doc
      - /share/man
      - /share/pkgconfig
      - "*.la"
      - "*.a"
    sources:
      - type: archive
        url: https://github.com/eudev-project/eudev/archive/refs/tags/v3.2.14.tar.gz
        sha256: c340e6c51dfc5531ac0c0fa84a34b72162acf525f9023eb9cf4931b782c8f177

  - name: NetworkManager
    buildsystem: meson
    build-options:
      cflags: -ltinfo
      cxxflags: -ltinfo
    config-opts:
      - -Dlibaudit=no
      - -Ddbus_conf_dir=/app/etc/dbus-1/system.d
      - -Ddnsmasq=/usr/bin/true
      - -Ddocs=false
      - -Dintrospection=true
      - -Diptables=/usr/bin/true
      - -Dlibpsl=false
      - -Dmodem_manager=false
      - -Dnmtui=false
      - -Dovs=false
      - -Dppp=false
      - -Dqt=false
      - -Dselinux=false
      - -Dsession_tracking=no
      - -Dsystemdsystemunitdir='no'
      - -Dsystemd_journal=false
      - -Dtests=no
      - -Dvapi=false
      - -Dwifi=true
      - -Dnm_cloud_setup=false
      - -Dnbft=false
    sources:
      - type: archive
        url: https://github.com/NetworkManager/NetworkManager/archive/refs/tags/1.54.1.tar.gz
        sha256: 3bec7f01698e416c58fe823d042de87fdc0e5ddf54d1871a8b65216070eb9a93

  - name: blueprint-compiler
    buildsystem: meson
    cleanup:
      - "*"
    sources:
      - type: git
        url: https://gitlab.gnome.org/GNOME/blueprint-compiler
        tag: 0.18.0

  - name: cobang
    builddir: true
    buildsystem: meson
    sources:
      - type: git
        branch: main
        path: .
